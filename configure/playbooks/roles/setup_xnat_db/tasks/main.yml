---
- name: Ensure postgres is running
  ansible.builtin.service:
    name: "{{ postgresql_service.name }}"
    state: started
    enabled: true

- name: "Create XNAT PostgreSQL user"
  become: true
  become_user: postgres
  community.postgresql.postgresql_user:
    name: "{{ db_server.postgresql_user }}"
    password: "{{ db_server.postgresql_password }}"
    port: "{{ db_server.port }}"

- name: "Create XNAT PostgreSQL db"
  become: true
  become_user: postgres
  community.postgresql.postgresql_db:
    name: "{{ db_server.postgresql_database }}"
    owner: "{{ db_server.postgresql_user }}"
    port: "{{ db_server.port }}"
